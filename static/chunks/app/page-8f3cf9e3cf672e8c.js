(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1168:(e,t,r)=>{"use strict";r.d(t,{K:()=>h});var a=r(5155),s=r(2115),i=r(5584),n=r(3999);function o(e){let{className:t,defaultValue:r,value:o,min:l=0,max:c=100,...d}=e,u=s.useMemo(()=>Array.isArray(o)?o:Array.isArray(r)?r:[l,c],[o,r,l,c]);return(0,a.jsxs)(i.bL,{"data-slot":"slider",defaultValue:r,value:o,min:l,max:c,className:(0,n.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...d,children:[(0,a.jsx)(i.CC,{"data-slot":"slider-track",className:(0,n.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,a.jsx)(i.Q6,{"data-slot":"slider-range",className:(0,n.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:u.length},(e,t)=>(0,a.jsx)(i.zi,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]})}var l=r(7168),c=r(9074),d=r(6262),u=r(4481),m=r(8145);function h(e){let{onDateRangeChange:t,startYear:r,endYear:i,activeStartYear:n,activeEndYear:h,clusters:f}=e,[g,v]=(0,s.useState)(1),x=f||[],p=(()=>{let e={};return(x||[]).forEach(t=>{var r;if(!(null===(r=t.firstImageMeta)||void 0===r?void 0:r.pub_date))return;let a=new Date(t.firstImageMeta.pub_date).getFullYear();isNaN(a)||(e[a]=(e[a]||0)+t.imagePaths.length)}),e})(),b=Math.max(...Object.values(p)),y=(()=>{let e=g>=2?10:g>=1.5?25:50,t=[];for(let r=1700;r<=2024;r+=e)t.push(r);return t})(),w=e=>(e-1700)/324*100,j=e=>e/b*40;return(0,a.jsxs)("div",{className:"mb-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Timeline"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)(m.E,{variant:"secondary",className:"text-sm",children:["From ",r," to ",i]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.$,{variant:"outline",size:"icon",onClick:()=>{g>.5&&v(g-.5)},children:(0,a.jsx)(d.A,{className:"h-4 w-4"})}),(0,a.jsx)(l.$,{variant:"outline",size:"icon",onClick:()=>{g<3&&v(g+.5)},children:(0,a.jsx)(u.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"relative border rounded-lg p-6 bg-background",children:[(0,a.jsx)("div",{className:"flex justify-between mb-4 text-xs text-muted-foreground",style:{width:"".concat(100*g,"%")},children:y.map(e=>(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"h-2 border-l border-muted-foreground"}),(0,a.jsx)("span",{children:e})]},e))}),(0,a.jsxs)("div",{className:"relative h-16 mb-6 bg-muted/20 rounded",style:{width:"".concat(100*g,"%")},children:[(0,a.jsx)("div",{className:"absolute top-0 bottom-0 bg-primary/20 rounded",style:{left:"".concat(w(r),"%"),width:"".concat(w(i)-w(r),"%")}}),n&&h&&(0,a.jsx)("div",{className:"absolute top-0 bottom-0 bg-green-500/30 rounded border-x-2 border-green-500",style:{left:"".concat(w(n),"%"),width:"".concat(w(h)-w(n),"%")}}),Object.entries(p).map(e=>{let[t,s]=e,n=Number.parseInt(t),o=n>=r&&n<=i;return(0,a.jsx)("div",{className:"absolute bottom-0 bg-primary/70 hover:bg-primary transition-colors cursor-pointer ".concat(o?"opacity-100":"opacity-40"),style:{left:"".concat(w(n),"%"),width:"".concat(Math.max(.5,1/324*100*(g>=2?3:g>=1.5?2:1)),"%"),height:"".concat(j(s),"px")},title:"".concat(t,": ").concat(s," images")},t)}),(0,a.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-primary border-l-2 border-primary",style:{left:"".concat(w(r),"%")}}),(0,a.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-primary border-l-2 border-primary",style:{left:"".concat(w(i),"%")}})]}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(o,{value:[r,i],min:1700,max:2024,step:1,onValueChange:e=>{let[r,a]=e;t(r,a)},className:"w-full"})})]})]})}},2482:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var a=r(5155),s=r(2115),i=r(1168),n=r(6766),o=r(6874),l=r.n(o),c=r(8482);function d(e){let{startYear:t,endYear:r}=e,[i,o]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[m,h]=(0,s.useState)(1),[f,g]=(0,s.useState)(!0),[v,x]=(0,s.useState)(null),p=(0,s.useRef)(null),b=(0,s.useRef)(null),[y,w]=(0,s.useState)(0),j=(0,s.useCallback)((e,t)=>Array.isArray(e)?e.map(e=>{let r=e.imagePaths,a=r.length>0?t.get(r[0]):void 0,s=r.map(e=>{var r;return(null===(r=t.get(e))||void 0===r?void 0:r.pub_date)?new Date(t.get(e).pub_date).getFullYear():0}).filter(e=>e>0),i=s.length>0?Math.min(...s):0,n=s.length>0?Math.max(...s):0;return{id:e.id,title:"Cluster ".concat(e.id),imageCount:r.length,featureImage:(null==a?void 0:a.prediction_section_iiif_url)||"/file.svg",alt:a?"".concat(a.name||"Unknown"," - ").concat(a.pub_date||"Unknown"):"Cluster image",startYear:i,endYear:n}}):(console.error("processClusters received non-array data:",e),[]),[]);(0,s.useEffect)(()=>{(async()=>{try{g(!0);let[e,t]=await Promise.all([fetch("/api/data?type=clusters"),fetch("/api/data?type=metadata")]);if(!e.ok)throw Error("Failed to fetch clusters");if(!t.ok)throw Error("Failed to fetch metadata");let r=await e.json(),a=await t.json(),s=new Map(a.map(e=>[e.filepath,e])),i=Object.entries(r).map(e=>{let[t,r]=e;return{id:t,imagePaths:Array.isArray(r)?r:[],firstImageMeta:r.length>0?s.get(r[0]):void 0}});o(i);let n=j(i.slice(0,10),s);u(n),h(1)}catch(e){e instanceof Error?x(e.message):x("An unknown error occurred")}finally{g(!1)}})()},[j]);let N=(0,s.useCallback)(()=>{g(!0);let e=m+1,t=(e-1)*10,r=i.slice(t,t+10);if(r.length>0){let t=j(r,new Map(i.flatMap(e=>e.imagePaths).map(e=>{var t;return null===(t=i.find(t=>t.imagePaths.includes(e)))||void 0===t?void 0:t.firstImageMeta}).filter(Boolean).map(e=>[e.filepath,e])));u(e=>[...e,...t]),h(e)}g(!1)},[i,m,j]),k=d.length<i.length;(0,s.useEffect)(()=>{if(!f&&k)return p.current=new IntersectionObserver(e=>{e[0].isIntersecting&&k&&!f&&N()},{root:null,rootMargin:"20px",threshold:1}),p.current&&document.querySelector("#load-more-trigger")&&p.current.observe(document.querySelector("#load-more-trigger")),()=>{p.current&&p.current.disconnect()}},[f,k,N]);let A=(0,s.useMemo)(()=>d.filter(e=>e.startYear>=t&&e.endYear<=r),[d,t,r]);return((0,s.useLayoutEffect)(()=>{if(!b.current)return;let e=()=>{let e=b.current;if(!e)return;let t=Array.from(e.children).filter(e=>e.classList.contains("masonry-item"));if(0===t.length)return;let r=window.innerWidth>=1024?10:window.innerWidth>=768?4:3,a=e.clientWidth/r,s=Array(r).fill(0);t.forEach(e=>{let t=Math.min(...s),r=s.indexOf(t);e.style.position="absolute",e.style.width="".concat(a-16,"px"),e.style.left="".concat(r*a+8,"px"),e.style.top="".concat(t+16,"px"),s[r]+=e.offsetHeight+16}),w(Math.max(...s))};return e(),window.addEventListener("resize",e),Promise.all(Array.from(b.current.querySelectorAll("img")).map(e=>e.complete?Promise.resolve():new Promise(t=>{e.onload=t}))).then(()=>{requestAnimationFrame(()=>{e()})}),()=>{window.removeEventListener("resize",e)}},[A]),f)?(0,a.jsx)("div",{className:"container mx-auto py-8 text-center",children:"Loading clusters..."}):v?(0,a.jsxs)("div",{className:"container mx-auto py-8 text-center text-red-500",children:["Error: ",v]}):(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("div",{ref:b,className:"relative",style:{height:y},children:[A.map(e=>(0,a.jsx)(l(),{href:"/cluster/".concat(e.id),className:"absolute block masonry-item",children:(0,a.jsx)(c.Zp,{className:"group relative cursor-pointer overflow-hidden p-0 w-full h-full",children:e.featureImage&&(0,a.jsxs)("div",{className:"relative w-full h-auto",children:[(0,a.jsx)(n.default,{src:e.featureImage,alt:e.alt||e.title,width:500,height:300,className:"w-full h-auto rounded-none transition-transform duration-300 group-hover:scale-105"}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-black/10 flex flex-col justify-end p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[(0,a.jsx)(c.ZB,{className:"text-white text-lg",children:e.title}),(0,a.jsxs)(c.BT,{className:"text-gray-200 text-sm",children:[e.imageCount," images (",e.startYear," - ",e.endYear,")"]})]})]})})},e.id)),f&&(0,a.jsx)("p",{className:"w-full text-center py-4",children:"Loading more clusters..."}),!f&&k&&(0,a.jsx)("div",{id:"load-more-trigger",style:{height:"1px",position:"absolute",bottom:"-50px",width:"100%"}}),!k&&(0,a.jsx)("p",{className:"text-center w-full py-4",children:"No more clusters to load."})]})})}function u(){let[e,t]=(0,s.useState)(1756),[r,n]=(0,s.useState)(1963),[o,l]=(0,s.useState)([]),[c,u]=(0,s.useState)(!0),[m,h]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{try{u(!0);let[e,t]=await Promise.all([fetch("/api/data?type=clusters"),fetch("/api/data?type=metadata")]);if(!e.ok)throw Error("Failed to fetch clusters");if(!t.ok)throw Error("Failed to fetch metadata");let r=await e.json(),a=await t.json(),s=new Map(a.map(e=>[e.filepath,e])),i=Object.entries(r).map(e=>{let[t,r]=e;return{id:t,imagePaths:Array.isArray(r)?r:[],firstImageMeta:r.length>0?s.get(r[0]):void 0}});l(i)}catch(e){e instanceof Error?h(e.message):h("An unknown error occurred")}finally{u(!1)}})()},[]),c)?(0,a.jsx)("div",{className:"px-4 py-4 text-center",children:"Loading application data..."}):m?(0,a.jsxs)("div",{className:"px-4 py-4 text-center text-red-500",children:["Error: ",m]}):(0,a.jsxs)("div",{className:"px-4 py-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center",children:"Viral Images"}),(0,a.jsx)(i.K,{startYear:e,endYear:r,onDateRangeChange:(e,r)=>{t(e),n(r)},clusters:o}),(0,a.jsx)(d,{startYear:e,endYear:r})]})}},3999:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i});var a=r(2596),s=r(9688);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},5114:(e,t,r)=>{Promise.resolve().then(r.bind(r,2482))},7168:(e,t,r)=>{"use strict";r.d(t,{$:()=>l});var a=r(5155);r(2115);var s=r(9708),i=r(2085),n=r(3999);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:r,size:i,asChild:l=!1,...c}=e,d=l?s.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,n.cn)(o({variant:r,size:i,className:t})),...c})}},8145:(e,t,r)=>{"use strict";r.d(t,{E:()=>l});var a=r(5155);r(2115);var s=r(9708),i=r(2085),n=r(3999);let o=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,asChild:i=!1,...l}=e,c=i?s.DX:"span";return(0,a.jsx)(c,{"data-slot":"badge",className:(0,n.cn)(o({variant:r}),t),...l})}},8482:(e,t,r)=>{"use strict";r.d(t,{BT:()=>o,Wu:()=>l,ZB:()=>n,Zp:()=>i});var a=r(5155);r(2115);var s=r(3999);function i(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-2 border py-2 shadow-sm",t),...r})}function n(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...r})}function o(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",t),...r})}function l(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-2",t),...r})}}},e=>{var t=t=>e(e.s=t);e.O(0,[516,441,684,358],()=>t(5114)),_N_E=e.O()}]);